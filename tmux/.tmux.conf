#!/usr/bin/env tmux
# =============================================================================
# Tmux Configuration
# =============================================================================
# Author: Jacob Penner
# Description: Modern tmux configuration with sensible defaults
# Last Updated: August 15, 2025
# =============================================================================

# =============================================================================
# Terminal & Environment Settings
# =============================================================================

# Set terminal type and color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",screen-256color:Tc"
set -ga terminal-overrides ",xterm-256color:Tc"

# Environment variables
set-environment -g COLORTERM "truecolor"

# Performance and stability settings
set -s escape-time 0           # Remove delay for escape key
set -g focus-events off        # Prevent escape sequence issues
set -g status-interval 5       # Update status every 5 seconds

# =============================================================================
# General Settings
# =============================================================================

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Enable mouse support
set -g mouse on

# Don't rename windows automatically
set-option -g allow-rename off

# Increase scrollback buffer size
set -g history-limit 10000

# Enable vi mode
setw -g mode-keys vi

# =============================================================================
# Key Bindings
# =============================================================================

# Reload configuration
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Pane splitting (intuitive keys)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
# bind \ split-window -h -c "#{pane_current_path}"  # Alternative for |

# Remove default split bindings
unbind '"'
unbind %

# Pane navigation (vim-like)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation
bind -r ^ last-window
bind -r n next-window
bind -r p previous-window

# Copy mode bindings (vi-like)
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

# Platform-specific copy commands
if-shell "uname | grep -q Darwin" \
    "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy'" \
    "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'"

# =============================================================================
# Custom Key Bindings
# =============================================================================

# Quick access to commonly used tools
bind -r f run-shell "tmux neww $HOME/tmux-sessionizer"
bind -r i run-shell "tmux neww $HOME/tmux-cht"
bind -r D neww -c "#{pane_current_path}" "[[ -e TODO.md ]] && nvim TODO.md || nvim $HOME/todo.md"

# Session management
bind C-s new-session
bind C-f command-prompt -p "find-session: " "switch-client -t %%"

# =============================================================================
# Status Bar Configuration
# =============================================================================

# Status bar general settings
set -g status on
set -g status-position bottom
set -g status-justify left
set -g status-left-length 20
set -g status-right-length 50

# Status bar colors and styling
set -g status-style 'bg=colour233 fg=colour137'

# Left side: session name
set -g status-left '#[fg=colour233,bg=colour245,bold] #S #[bg=colour233] '

# Right side: date and time
set -g status-right '#[fg=colour233,bg=colour241,bold] %d/%m #[fg=colour233,bg=colour245,bold] %H:%M:%S '

# Window status styling
setw -g window-status-style 'fg=colour9 bg=colour235'
setw -g window-status-format ' #I:#W#F '

setw -g window-status-current-style 'fg=colour1 bg=colour238 bold'
setw -g window-status-current-format ' #I:#W#F '

# Window separator
setw -g window-status-separator ''

# =============================================================================
# Pane Styling
# =============================================================================

# Pane borders
set -g pane-border-style 'fg=colour238'
set -g pane-active-border-style 'fg=colour208'

# Pane number display
set -g display-panes-time 2000
set -g display-panes-colour colour166
set -g display-panes-active-colour colour33

# =============================================================================
# Message & Command Styling
# =============================================================================

# Message styling
set -g message-style 'bg=colour208 fg=colour16 bold'
set -g message-command-style 'bg=colour208 fg=colour16 bold'

# =============================================================================
# Local Configuration
# =============================================================================

# Load local configuration if it exists
if-shell "test -f ~/.tmux.conf.local" "source ~/.tmux.conf.local"

# =============================================================================
# Plugin Management (Optional)
# =============================================================================

# Uncomment the following lines if you want to use TPM (Tmux Plugin Manager)
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

# Initialize TMUX plugin manager (keep this line at the very bottom)
# run '~/.tmux/plugins/tpm/tpm'
